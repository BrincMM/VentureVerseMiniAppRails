<h1>Credit Spents</h1>

<% if @user.present? %>
  <div class="d-flex justify-content-between align-items-center mb-3">
    <p class="mb-0"><strong>User:</strong> <%= @user.first_name %> <%= @user.last_name %> (<%= @user.email %>)</p>
    <%= link_to "Back to User Detail", admin_user_path(@user), class: "btn btn-outline-secondary btn-sm" %>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title mb-3">Summary</h5>
      <p class="mb-1"><strong>Total Records:</strong> <%= @credit_spents_count %></p>
      <p class="mb-1"><strong>Total Credits:</strong> <%= @credit_spents_total %></p>
      <p class="mb-0"><strong>Total Cost (USD):</strong> <%= number_to_currency(@credit_spents_total_cost) %></p>
    </div>
  </div>
<% else %>
  <div class="d-flex justify-content-between align-items-center mb-3">
    <p class="mb-0 text-muted">Showing all credit spents.</p>
  </div>
<% end %>

<% if @credit_spents.any? %>
  <table class="table table-bordered table-sm">
    <thead>
      <tr>
        <th>ID</th>
        <% unless @user.present? %>
          <th>User</th>
        <% end %>
        <th>Credits</th>
        <th>Type</th>
        <th>Cost (USD)</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody>
      <% @credit_spents.each do |spent| %>
        <tr>
          <td><%= spent.id %></td>
          <% unless @user.present? %>
            <td>
              <%= link_to admin_user_path(spent.user) do %>
                <%= spent.user.email %>
              <% end %>
            </td>
          <% end %>
          <td><%= spent.credits %></td>
          <td><%= spent.spend_type.humanize %></td>
          <td><%= number_to_currency(spent.cost_in_usd) %></td>
          <td><%= spent.timestamp.strftime('%Y-%m-%d %H:%M') %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <div class="mt-3">
    <%= paginate @credit_spents, theme: 'bootstrap-5', pagination_class: "pagination-sm flex-wrap justify-content-center", nav_class: "d-inline-block" %>
  </div>
<% else %>
  <p class="text-muted">No credit spents found.</p>
<% end %>

