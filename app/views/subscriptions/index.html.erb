<!DOCTYPE html>
<html>
  <head>
    <title>Choose Your Subscription Plan</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 40px 20px;
        background-color: #f8f9fa;
        color: #333;
      }
      
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      
      h1 {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 50px;
        font-size: 2.5rem;
        font-weight: 300;
      }
      
      .plans-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
        margin-top: 40px;
      }
      
      .plan-card {
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      
      .plan-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }
      
      .plan-name {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: #2c3e50;
      }
      
      .plan-description {
        color: #7f8c8d;
        margin-bottom: 30px;
        line-height: 1.6;
      }
      
      .subscribe-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 8px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        text-decoration: none;
        display: inline-block;
        box-sizing: border-box;
      }
      
      .subscribe-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        text-decoration: none;
        color: white;
      }
      
      .subscribe-btn:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
        opacity: 0.6;
      }
      
      .user-info {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      
      .user-selector {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      
      .user-selector select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e1e5e9;
        border-radius: 6px;
        font-size: 1rem;
        background-color: white;
        margin-top: 10px;
      }
      
      .user-selector select:focus {
        outline: none;
        border-color: #667eea;
      }
      
      .user-selector label {
        font-weight: 600;
        color: #2c3e50;
        display: block;
        margin-bottom: 5px;
      }
      
      .alert {
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 8px;
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      
      .launch { border-top: 4px solid #3498db; }
      .fly { border-top: 4px solid #e74c3c; }
      .soar { border-top: 4px solid #f39c12; }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>Choose Your Subscription Plan</h1>
      
      <% if notice %>
        <div class="alert alert-success"><%= notice %></div>
      <% end %>
      
      <% if alert %>
        <div class="alert"><%= alert %></div>
      <% end %>
      
      <div class="user-selector">
        <%= form_with url: subscriptions_path, method: :get, local: true do |form| %>
          <%= form.label :user_id, "Select User for Testing:" %>
          <%= form.select :user_id, 
                options_for_select([["Select a user...", ""]] + 
                  @users.map { |u| ["#{u.first_name} #{u.last_name} (#{u.email})", u.id] }, 
                  @selected_user_id), 
                {}, 
                { onchange: "this.form.submit();" } %>
        <% end %>
      </div>
      
      <% if @user %>
        <div class="user-info">
          <strong>Selected User:</strong> <%= @user.first_name %> <%= @user.last_name %> (<%= @user.email %>)
          <br>
          <strong>Current Credits:</strong> <%= @user.monthly_credit_balance %> monthly, <%= @user.topup_credit_balance %> topup
          <% if @user.stripe_info %>
            <br>
            <strong>Subscription Status:</strong> <%= @user.stripe_info.subscription_status || "None" %>
          <% end %>
        </div>
      <% else %>
        <div class="alert">
          Please select a user above to continue with subscription.
        </div>
      <% end %>
      
      <div class="plans-container">
        <div class="plan-card launch">
          <div class="plan-name">Launch Plan</div>
          <div class="plan-description">
            Perfect for getting started with your venture. Includes basic features and support to launch your ideas.
          </div>
          <%= form_with url: create_subscription_path('launch'), method: :post, local: true, data: { turbo: false } do |form| %>
            <%= form.hidden_field :user_id, value: @user&.id %>
            <%= form.submit "Subscribe to Launch Plan", class: "subscribe-btn", disabled: @user.nil? %>
          <% end %>
        </div>
        
        <div class="plan-card fly">
          <div class="plan-name">Fly Plan</div>
          <div class="plan-description">
            Accelerate your growth with advanced features. Ideal for scaling ventures that need more power and flexibility.
          </div>
          <%= form_with url: create_subscription_path('fly'), method: :post, local: true, data: { turbo: false } do |form| %>
            <%= form.hidden_field :user_id, value: @user&.id %>
            <%= form.submit "Subscribe to Fly Plan", class: "subscribe-btn", disabled: @user.nil? %>
          <% end %>
        </div>
        
        <div class="plan-card soar">
          <div class="plan-name">Soar Plan</div>
          <div class="plan-description">
            The ultimate plan for ambitious ventures. Premium features, priority support, and unlimited possibilities.
          </div>
          <%= form_with url: create_subscription_path('soar'), method: :post, local: true, data: { turbo: false } do |form| %>
            <%= form.hidden_field :user_id, value: @user&.id %>
            <%= form.submit "Subscribe to Soar Plan", class: "subscribe-btn", disabled: @user.nil? %>
          <% end %>
        </div>
      </div>
    </div>
  </body>
</html>
